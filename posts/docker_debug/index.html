<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Docker 调试技巧 | mtunique blog</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Docker 调试技巧"><meta property="og:description" content="『重用』容器名 但我们在编写/调试Dockerfile的时候我们经常会重复之前的command，比如这种docker run --name jstorm-zookeeper zookeeper:3.4，然后就容器名就冲突了。
$ docker run --name jstorm-zookeeper zookeeper:3.4 ... $ docker run --name jstorm-zookeeper zookeeper:3.4 docker: Error response from daemon: Conflict. The name &#34;/jstorm-zookeeper&#34; is already in use by container xxxxxxxxx 可以在运行 docker run 时候加上--rm flag, 容器将在退出之后销毁。无需手动docker rm CONTAINER
$ docker run --name jstorm-zookeeper zookeeper:3.4 --rm # reuse  $ docker create --name jstorm-zookeeper zookeeper:3.4 $ docker start jstorm-zookeeper # no error debug Dockerfile 在写 Dockerfile 的时候，通常并不会一气呵成。有的时候容器启动就crash 直接退出，有的时候build image 就会失败，或者想验证Dockerfile是否符合预期，我们经常要debug Dockerfile。"><meta property="og:type" content="article"><meta property="og:url" content="https://mtunique.com/posts/docker_debug/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-12-17T22:30:27+08:00"><meta property="article:modified_time" content="2016-12-17T22:30:27+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Docker 调试技巧"><meta name=twitter:description content="『重用』容器名 但我们在编写/调试Dockerfile的时候我们经常会重复之前的command，比如这种docker run --name jstorm-zookeeper zookeeper:3.4，然后就容器名就冲突了。
$ docker run --name jstorm-zookeeper zookeeper:3.4 ... $ docker run --name jstorm-zookeeper zookeeper:3.4 docker: Error response from daemon: Conflict. The name &#34;/jstorm-zookeeper&#34; is already in use by container xxxxxxxxx 可以在运行 docker run 时候加上--rm flag, 容器将在退出之后销毁。无需手动docker rm CONTAINER
$ docker run --name jstorm-zookeeper zookeeper:3.4 --rm # reuse  $ docker create --name jstorm-zookeeper zookeeper:3.4 $ docker start jstorm-zookeeper # no error debug Dockerfile 在写 Dockerfile 的时候，通常并不会一气呵成。有的时候容器启动就crash 直接退出，有的时候build image 就会失败，或者想验证Dockerfile是否符合预期，我们经常要debug Dockerfile。"><link rel=stylesheet href=https://mtunique.com/css/style-dark.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://mtunique.com/images/favicon.ico><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-65601165-1','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast')" style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://mtunique.com/posts/spark_api/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle()" onmouseout="$('#i-prev').toggle()"></i></a></li><li><a class=icon href=https://mtunique.com/posts/spark_flink_mem/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle()" onmouseout="$('#i-next').toggle()"></i></a></li><li><a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle()" onmouseout="$('#i-top').toggle()"></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle()" onmouseout="$('#i-share').toggle()" onclick="return $('#share').toggle(),!1"></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fmtunique.com%2fposts%2fdocker_debug%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fmtunique.com%2fposts%2fdocker_debug%2f&text=Docker%20%e8%b0%83%e8%af%95%e6%8a%80%e5%b7%a7" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fmtunique.com%2fposts%2fdocker_debug%2f&title=Docker%20%e8%b0%83%e8%af%95%e6%8a%80%e5%b7%a7" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fmtunique.com%2fposts%2fdocker_debug%2f&is_video=false&description=Docker%20%e8%b0%83%e8%af%95%e6%8a%80%e5%b7%a7" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Docker%20%e8%b0%83%e8%af%95%e6%8a%80%e5%b7%a7&body=Check out this article: https%3a%2f%2fmtunique.com%2fposts%2fdocker_debug%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fmtunique.com%2fposts%2fdocker_debug%2f&title=Docker%20%e8%b0%83%e8%af%95%e6%8a%80%e5%b7%a7" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fmtunique.com%2fposts%2fdocker_debug%2f&title=Docker%20%e8%b0%83%e8%af%95%e6%8a%80%e5%b7%a7" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fmtunique.com%2fposts%2fdocker_debug%2f&name=Docker%20%e8%b0%83%e8%af%95%e6%8a%80%e5%b7%a7&description=%e3%80%8e%e9%87%8d%e7%94%a8%e3%80%8f%e5%ae%b9%e5%99%a8%e5%90%8d%20%e4%bd%86%e6%88%91%e4%bb%ac%e5%9c%a8%e7%bc%96%e5%86%99%2f%e8%b0%83%e8%af%95Dockerfile%e7%9a%84%e6%97%b6%e5%80%99%e6%88%91%e4%bb%ac%e7%bb%8f%e5%b8%b8%e4%bc%9a%e9%87%8d%e5%a4%8d%e4%b9%8b%e5%89%8d%e7%9a%84command%ef%bc%8c%e6%af%94%e5%a6%82%e8%bf%99%e7%a7%8ddocker%20run%20--name%20jstorm-zookeeper%20zookeeper%3a3.4%ef%bc%8c%e7%84%b6%e5%90%8e%e5%b0%b1%e5%ae%b9%e5%99%a8%e5%90%8d%e5%b0%b1%e5%86%b2%e7%aa%81%e4%ba%86%e3%80%82%0a%24%20docker%20run%20--name%20jstorm-zookeeper%20zookeeper%3a3.4%20...%20%24%20docker%20run%20--name%20jstorm-zookeeper%20zookeeper%3a3.4%20docker%3a%20Error%20response%20from%20daemon%3a%20Conflict.%20The%20name%20%26%2334%3b%2fjstorm-zookeeper%26%2334%3b%20is%20already%20in%20use%20by%20container%20xxxxxxxxx%20%e5%8f%af%e4%bb%a5%e5%9c%a8%e8%bf%90%e8%a1%8c%20docker%20run%20%e6%97%b6%e5%80%99%e5%8a%a0%e4%b8%8a--rm%20flag%2c%20%e5%ae%b9%e5%99%a8%e5%b0%86%e5%9c%a8%e9%80%80%e5%87%ba%e4%b9%8b%e5%90%8e%e9%94%80%e6%af%81%e3%80%82%e6%97%a0%e9%9c%80%e6%89%8b%e5%8a%a8docker%20rm%20CONTAINER%0a%24%20docker%20run%20--name%20jstorm-zookeeper%20zookeeper%3a3.4%20--rm%20%23%20reuse%20%20%24%20docker%20create%20--name%20jstorm-zookeeper%20zookeeper%3a3.4%20%24%20docker%20start%20jstorm-zookeeper%20%23%20no%20error%20debug%20Dockerfile%20%e5%9c%a8%e5%86%99%20Dockerfile%20%e7%9a%84%e6%97%b6%e5%80%99%ef%bc%8c%e9%80%9a%e5%b8%b8%e5%b9%b6%e4%b8%8d%e4%bc%9a%e4%b8%80%e6%b0%94%e5%91%b5%e6%88%90%e3%80%82%e6%9c%89%e7%9a%84%e6%97%b6%e5%80%99%e5%ae%b9%e5%99%a8%e5%90%af%e5%8a%a8%e5%b0%b1crash%20%e7%9b%b4%e6%8e%a5%e9%80%80%e5%87%ba%ef%bc%8c%e6%9c%89%e7%9a%84%e6%97%b6%e5%80%99build%20image%20%e5%b0%b1%e4%bc%9a%e5%a4%b1%e8%b4%a5%ef%bc%8c%e6%88%96%e8%80%85%e6%83%b3%e9%aa%8c%e8%af%81Dockerfile%e6%98%af%e5%90%a6%e7%ac%a6%e5%90%88%e9%a2%84%e6%9c%9f%ef%bc%8c%e6%88%91%e4%bb%ac%e7%bb%8f%e5%b8%b8%e8%a6%81debug%20Dockerfile%e3%80%82" aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fmtunique.com%2fposts%2fdocker_debug%2f&t=Docker%20%e8%b0%83%e8%af%95%e6%8a%80%e5%b7%a7" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#重用容器名>『重用』容器名</a></li><li><a href=#debug-dockerfile>debug Dockerfile</a></li><li><a href=#logs-查看-stdout><code>logs</code> 查看 stdout</a></li><li><a href=#attach-实时查看stdout><code>attach</code> 实时查看stdout</a></li><li><a href=#执行任意command>执行任意command</a></li><li><a href=#重写entrypoint和cmd>重写<code>entrypoint</code>和<code>cmd</code></a></li><li><a href=#暂停容器>暂停容器</a></li><li><a href=#top-和-stats-获得容器中进程的状态><code>top</code> 和 <code>stats</code> 获得容器中进程的状态</a></li><li><a href=#通过-inspect-查看容器的详细信息>通过 <code>inspect</code> 查看容器的详细信息</a></li><li><a href=#history-查看-image-layers><code>history</code> 查看 image layers</a></li></ul></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Docker 调试技巧</h1><div class=meta><div class=postdate><time datetime="2016-12-17 22:30:27 +0800 +0800" itemprop=datePublished>2016-12-17</time></div><div class=article-read-time><i class="far fa-clock"></i>
9 minute read</div><div class=article-category><i class="fas fa-archive"></i>
<a class=category-link href=/categories/docker>docker</a></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/docker rel=tag>docker</a></div></div></header><div class=content itemprop=articleBody><h3 id=重用容器名>『重用』容器名</h3><p>但我们在编写/调试Dockerfile的时候我们经常会重复之前的command，比如这种<code>docker run --name jstorm-zookeeper zookeeper:3.4</code>，然后就容器名就冲突了。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ docker run --name jstorm-zookeeper zookeeper:3.4
...
$ docker run --name jstorm-zookeeper zookeeper:3.4
docker: Error response from daemon: Conflict. The name <span style=color:#e6db74>&#34;/jstorm-zookeeper&#34;</span> is already in use by container xxxxxxxxx
</code></pre></div><p>可以在运行 <code>docker run</code> 时候加上<code>--rm</code> flag, 容器将在退出之后销毁。无需手动<code>docker rm CONTAINER</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ docker run --name jstorm-zookeeper zookeeper:3.4 --rm

<span style=color:#75715e># reuse </span>
$ docker create --name jstorm-zookeeper zookeeper:3.4
$ docker start jstorm-zookeeper

<span style=color:#75715e># no error</span>
</code></pre></div><h3 id=debug-dockerfile>debug Dockerfile</h3><p>在写 <code>Dockerfile</code> 的时候，通常并不会一气呵成。有的时候容器启动就crash 直接退出，有的时候build image 就会失败，或者想验证Dockerfile是否符合预期，我们经常要debug Dockerfile。</p><p>如果build 失败可以直接 查看stdout的错误信息，拆分指令，重新build。</p><h3 id=logs-查看-stdout><code>logs</code> 查看 stdout</h3><p>所有容器内写到stdout的内容都会被捕获到host中的一个history文件中, 可以通过 <code>docker logs CONTAINER</code> 查看。</p><pre><code>$ docker run -d --name jstorm-zookeeper zookeeper:3.4

$ docker logs jstorm-zookeeper
ZooKeeper JMX enabled by default
Using config: /conf/zoo.cfg
2016-12-18 05:55:27,717 [myid:] - INFO  [main:QuorumPeerConfig@124] - Reading configuration from: /conf/zoo.cfg
2016-12-18 05:55:27,725 [myid:] - INFO  [main:DatadirCleanupManager@78] - autopurge.snapRetainCount set to 3
2016-12-18 05:55:27,725 [myid:] - INFO  [main:DatadirCleanupManager@79] - autopurge.purgeInterval set to 0
2016-12-18 05:55:27,726 [myid:] - INFO  [main:DatadirCleanupManager@101] - Purge task is not scheduled.
2016-12-18 05:55:27,728 [myid:] - WARN  [main:QuorumPeerMain@113] - Either no config or no quorum defined in config, running  in standalone mode
2016-12-18 05:55:27,746 [myid:] - INFO  [main:QuorumPeerConfig@124] - Reading configuration from: /conf/zoo.cfg
2016-12-18 05:55:27,747 [myid:] - INFO  [main:ZooKeeperServerMain@96] - Starting server
2016-12-18 05:55:27,766 [myid:] - INFO  [main:Environment@100] - Server environment:zookeeper.version=3.4.9-1757313, built on 08/23/2016 06:50 GMT
2016-12-18 05:55:27,766 [myid:] - INFO  [main:Environment@100] - Server environment:host.name=dbc742dd5688
2016-12-18 05:55:27,767 [myid:] - INFO  [main:Environment@100] - Server environment:java.version=1.8.0_111-internal
</code></pre><p>即使是容器已经退出的也可以看到，所以可以通过这种方式来分析非预期的退出。这些文件一直保存着，直到通过<code>docker rm</code>把容器删除。文件的具体路径可以通过<code>docker inspect CONTAINER</code> 获得。
（然后osx上你并找不到这些文件，因为其实osx的docker实际是运行在"VM"中，具体就不展开了，但是可以通过 <code>screen ~/Library/Containers/com.docker.docker/Data/com.docker.driver.amd64-linux/tty</code> touch上"VM"的tty）</p><p>在使用<code>docker logs</code> 的时候加一些参数来过滤log，默认输出所有log。</p><pre><code>Options:
      --details        Show extra details provided to logs
  -f, --follow         Follow log output
      --help           Print usage
      --since string   Show logs since timestamp
      --tail string    Number of lines to show from the end of the logs (default &quot;all&quot;)
  -t, --timestamps     Show timestamps
</code></pre><h3 id=attach-实时查看stdout><code>attach</code> 实时查看stdout</h3><p>如果你想实时查看容器的输出你可以用 <code>docker attach CONTAINER</code> 命令。</p><p>默认会绑定stdin，代理signals， 所以如果你 <code>ctrl-c</code> 容器通常会退出。很多时候大家并不想这样，只是想分离开，可以<code>ctrl-p ctrl-q</code>。</p><h3 id=执行任意command>执行任意command</h3><p>可以通过<code>docker exec CONTAINER COMMAND</code>，来在容器内执行任意 command，比如 cat 一些东西来debug。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ docker run -d --name jstorm-zookeeper zookeeper:3.4

$ docker exec jstorm-zookeeper java -version
openjdk version <span style=color:#e6db74>&#34;1.8.0_111-internal&#34;</span>
OpenJDK Runtime Environment <span style=color:#f92672>(</span>build 1.8.0_111-internal-alpine-r0-b14<span style=color:#f92672>)</span>
OpenJDK 64-Bit Server VM <span style=color:#f92672>(</span>build 25.111-b14, mixed mode<span style=color:#f92672>)</span>
</code></pre></div><p>也可以直接通过 exec 在容器内启动一个 shell 更方便地调试容器，不必一条条执行<code>docker exec</code>。</p><pre><code>$ docker exec -it jstorm-zookeeper /bin/bash
bash-4.3# pwd
/zookeeper-3.4.9
</code></pre><p><code>docker exec</code> 只能在正在运行的容器上使用，如果已经停止了退出了就不行了，就只好用 <code>docker logs</code> 了。</p><h3 id=重写entrypoint和cmd>重写<code>entrypoint</code>和<code>cmd</code></h3><p>每个Docker镜像都有 <code>entrypoint</code> 和 <code>cmd</code> , 可以定义在 <code>Dockerfile</code> 中，也可以在运行时指定。这两个概念很容易混淆，而且它们的试用方式也不同。</p><p><code>entrypoint</code> 比 <code>cmd</code> 更"高级"，<code>entrypoint</code> 作为容器中pid为1的进程运行（docker不是虚拟机，只是隔离的进程。真正的linux中pid为1的是<code>init</code>）。
<code>cmd</code> 只是 <code>entrypoint</code>的参数:</p><pre><code>&lt;ENTRYPOINT&gt; &quot;&lt;CMD&gt;&quot;
</code></pre><p>当我们没有指定 <code>entrypoint</code> 时缺省为 <code>/bin/sh -c</code>。所以其实 <code>entrypoint</code> 是真正表达这个docker应该干什么的，通常大家有一个shell 脚本来代理。
<code>entrypoint</code> 和 <code>cmd</code> 都可以在运行的时候更改，通过更改来看这样设置<code>entrypoint</code>是否优雅合理。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ docker run -it --name jstorm-zookeeper --entrypoint /bin/bash zookeeper:3.4
bash-4.3# top
Mem: 320212K used, 1725368K free, 89112K shrd, 35532K buff, 130532K cached
CPU:   0% usr   0% sys   0% nic 100% idle   0% io   0% irq   0% sirq
Load average: 0.20 0.06 0.02 5/195 <span style=color:#ae81ff>7</span>
  PID  PPID USER     STAT   VSZ %VSZ CPU %CPU COMMAND
    <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>0</span> root     S     <span style=color:#ae81ff>6220</span>   0%   <span style=color:#ae81ff>0</span>   0% /bin/bash
    <span style=color:#ae81ff>7</span>     <span style=color:#ae81ff>1</span> root     R     <span style=color:#ae81ff>1516</span>   0%   <span style=color:#ae81ff>2</span>   0% top
</code></pre></div><p>任何 <code>docker run</code> 命令中在image名后的内容都作为<code>cmd</code>的内容传给 <code>entrypoint</code>当参数。</p><h3 id=暂停容器>暂停容器</h3><p>使用 <code>docker pause</code> 可以暂停容器中所有进程。这非常有用。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ docker run -d --name jstorm-zookeeper zookeeper:3.4 <span style=color:#f92672>&amp;&amp;</span> sleep 0.1 <span style=color:#f92672>&amp;&amp;</span> docker pause jstorm-zookeeper <span style=color:#f92672>&amp;&amp;</span> docker logs jstorm-zookeeper
a24405a53ddd9b7d94d9e77fe2b5a67639a251d681aa2f34fcb0cc96f347ba48
jstorm-zookeeper
ZooKeeper JMX enabled by default
Using config: /conf/zoo.cfg
2016-12-18 16:17:47,720 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:QuorumPeerConfig@124<span style=color:#f92672>]</span> - Reading configuration from: /conf/zoo.cfg
2016-12-18 16:17:47,730 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:DatadirCleanupManager@78<span style=color:#f92672>]</span> - autopurge.snapRetainCount set to <span style=color:#ae81ff>3</span>
2016-12-18 16:17:47,730 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:DatadirCleanupManager@79<span style=color:#f92672>]</span> - autopurge.purgeInterval set to <span style=color:#ae81ff>0</span>
2016-12-18 16:17:47,730 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:DatadirCleanupManager@101<span style=color:#f92672>]</span> - Purge task is not scheduled.
2016-12-18 16:17:47,731 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - WARN  <span style=color:#f92672>[</span>main:QuorumPeerMain@113<span style=color:#f92672>]</span> - Either no config or no quorum defined in config, running  in standalone mode
2016-12-18 16:17:47,757 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:QuorumPeerConfig@124<span style=color:#f92672>]</span> - Reading configuration from: /conf/zoo.cfg
2016-12-18 16:17:47,757 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:ZooKeeperServerMain@96<span style=color:#f92672>]</span> - Starting server

$ docker unpause jstorm-zookeeper <span style=color:#f92672>&amp;&amp;</span> docker logs jstorm-zookeeper
jstorm-zookeeper
ZooKeeper JMX enabled by default
Using config: /conf/zoo.cfg
2016-12-18 16:17:47,720 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:QuorumPeerConfig@124<span style=color:#f92672>]</span> - Reading configuration from: /conf/zoo.cfg
2016-12-18 16:17:47,730 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:DatadirCleanupManager@78<span style=color:#f92672>]</span> - autopurge.snapRetainCount set to <span style=color:#ae81ff>3</span>
2016-12-18 16:17:47,730 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:DatadirCleanupManager@79<span style=color:#f92672>]</span> - autopurge.purgeInterval set to <span style=color:#ae81ff>0</span>
2016-12-18 16:17:47,730 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:DatadirCleanupManager@101<span style=color:#f92672>]</span> - Purge task is not scheduled.
2016-12-18 16:17:47,731 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - WARN  <span style=color:#f92672>[</span>main:QuorumPeerMain@113<span style=color:#f92672>]</span> - Either no config or no quorum defined in config, running  in standalone mode
2016-12-18 16:17:47,757 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:QuorumPeerConfig@124<span style=color:#f92672>]</span> - Reading configuration from: /conf/zoo.cfg
2016-12-18 16:17:47,757 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:ZooKeeperServerMain@96<span style=color:#f92672>]</span> - Starting server
2016-12-18 16:18:09,039 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:Environment@100<span style=color:#f92672>]</span> - Server environment:zookeeper.version<span style=color:#f92672>=</span>3.4.9-1757313, built on 08/23/2016 06:50 GMT
2016-12-18 16:18:09,040 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:Environment@100<span style=color:#f92672>]</span> - Server environment:host.name<span style=color:#f92672>=</span>a24405a53ddd
2016-12-18 16:18:09,040 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:Environment@100<span style=color:#f92672>]</span> - Server environment:java.version<span style=color:#f92672>=</span>1.8.0_111-internal
2016-12-18 16:18:09,040 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:Environment@100<span style=color:#f92672>]</span> - Server environment:java.vendor<span style=color:#f92672>=</span>Oracle Corporation
2016-12-18 16:18:09,040 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:Environment@100<span style=color:#f92672>]</span> - Server environment:java.home<span style=color:#f92672>=</span>/usr/lib/jvm/java-1.8-openjdk/jre
2016-12-18 16:18:09,040 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:Environment@100<span style=color:#f92672>]</span> - Server environment:java.class.path<span style=color:#f92672>=</span>/zookeeper-3.4.9/bin/../build/classes:/zookeeper-3.4.9/bin/../build/lib/*.jar:/zookeeper-3.4.9/bin/../lib/slf4j-log4j12-1.6.1.jar:/zookeeper-3.4.9/bin/../lib/slf4j-api-1.6.1.jar:/zookeeper-3.4.9/bin/../lib/netty-3.10.5.Final.jar:/zookeeper-3.4.9/bin/../lib/log4j-1.2.16.jar:/zookeeper-3.4.9/bin/../lib/jline-0.9.94.jar:/zookeeper-3.4.9/bin/../zookeeper-3.4.9.jar:/zookeeper-3.4.9/bin/../src/java/lib/*.jar:/conf:
2016-12-18 16:18:09,040 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:Environment@100<span style=color:#f92672>]</span> - Server environment:java.library.path<span style=color:#f92672>=</span>/usr/lib/jvm/java-1.8-openjdk/jre/lib/amd64/server:/usr/lib/jvm/java-1.8-openjdk/jre/lib/amd64:/usr/lib/jvm/java-1.8-openjdk/jre/../lib/amd64:/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib
2016-12-18 16:18:09,041 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:Environment@100<span style=color:#f92672>]</span> - Server environment:java.io.tmpdir<span style=color:#f92672>=</span>/tmp
2016-12-18 16:18:09,041 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:Environment@100<span style=color:#f92672>]</span> - Server environment:java.compiler<span style=color:#f92672>=</span>&lt;NA&gt;
2016-12-18 16:18:09,043 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:Environment@100<span style=color:#f92672>]</span> - Server environment:os.name<span style=color:#f92672>=</span>Linux
2016-12-18 16:18:09,043 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:Environment@100<span style=color:#f92672>]</span> - Server environment:os.arch<span style=color:#f92672>=</span>amd64
2016-12-18 16:18:09,044 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:Environment@100<span style=color:#f92672>]</span> - Server environment:os.version<span style=color:#f92672>=</span>4.4.27-moby
2016-12-18 16:18:09,044 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:Environment@100<span style=color:#f92672>]</span> - Server environment:user.name<span style=color:#f92672>=</span>zookeeper
2016-12-18 16:18:09,044 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:Environment@100<span style=color:#f92672>]</span> - Server environment:user.home<span style=color:#f92672>=</span>/home/zookeeper
2016-12-18 16:18:09,044 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:Environment@100<span style=color:#f92672>]</span> - Server environment:user.dir<span style=color:#f92672>=</span>/zookeeper-3.4.9
2016-12-18 16:18:09,057 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:ZooKeeperServer@815<span style=color:#f92672>]</span> - tickTime set to <span style=color:#ae81ff>2000</span>
2016-12-18 16:18:09,057 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:ZooKeeperServer@824<span style=color:#f92672>]</span> - minSessionTimeout set to -1
2016-12-18 16:18:09,058 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:ZooKeeperServer@833<span style=color:#f92672>]</span> - maxSessionTimeout set to -1
2016-12-18 16:18:09,076 <span style=color:#f92672>[</span>myid:<span style=color:#f92672>]</span> - INFO  <span style=color:#f92672>[</span>main:NIOServerCnxnFactory@89<span style=color:#f92672>]</span> - binding to port 0.0.0.0/0.0.0.0:2181
</code></pre></div><h3 id=top-和-stats-获得容器中进程的状态><code>top</code> 和 <code>stats</code> 获得容器中进程的状态</h3><p><code>docker top CONTAINER</code> 和在容器里执行 <code>top</code> 的效果类似。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ docker top jstorm-zookeeper
PID    USER      TIME  COMMAND
<span style=color:#ae81ff>24593</span>  dockrema  0:01  /usr/lib/jvm/java-1.8-openjdk/jre/bin/java -Dzookeeper.log.dir<span style=color:#f92672>=</span>. .....

$ docker stats jstorm-zookeeper
CONTAINER           CPU %     MEM USAGE / LIMIT       MEM %   NET I/O        BLOCK I/O   PIDS
jstorm-zookeeper    0.00%     24.86 MiB / 1.951 GiB   1.24%   <span style=color:#ae81ff>648</span> B / <span style=color:#ae81ff>648</span> B  <span style=color:#ae81ff>0</span> B / <span style=color:#ae81ff>0</span> B   <span style=color:#ae81ff>20</span>
</code></pre></div><h3 id=通过-inspect-查看容器的详细信息>通过 <code>inspect</code> 查看容器的详细信息</h3><p><code>docker inspect CONTAINER</code> 饭后镜像和容器的详细信息。比如：</p><ul><li>State —— 容器的当先状态</li><li>LogPath —— history(stdout) file 的路径</li><li>Config.Env —— 环境变量</li><li>NetworkSettings.Ports —— 端口的映射关系</li></ul><p>环境变量非常有用很多问题都是环境变量引起的。</p><h3 id=history-查看-image-layers><code>history</code> 查看 image layers</h3><p>可以看到各层创建的指令，大小和哈希。可以用来检查这个image是否符合你的预期。</p></div></article><div class=blog-post-comments><div id=disqus_thread><script type=text/javascript>(function(){var a=document.createElement('script'),b;a.type='text/javascript',a.async=!0,b='mtunique',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><ul><li><a href=#重用容器名>『重用』容器名</a></li><li><a href=#debug-dockerfile>debug Dockerfile</a></li><li><a href=#logs-查看-stdout><code>logs</code> 查看 stdout</a></li><li><a href=#attach-实时查看stdout><code>attach</code> 实时查看stdout</a></li><li><a href=#执行任意command>执行任意command</a></li><li><a href=#重写entrypoint和cmd>重写<code>entrypoint</code>和<code>cmd</code></a></li><li><a href=#暂停容器>暂停容器</a></li><li><a href=#top-和-stats-获得容器中进程的状态><code>top</code> 和 <code>stats</code> 获得容器中进程的状态</a></li><li><a href=#通过-inspect-查看容器的详细信息>通过 <code>inspect</code> 查看容器的详细信息</a></li><li><a href=#history-查看-image-layers><code>history</code> 查看 image layers</a></li></ul></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fmtunique.com%2fposts%2fdocker_debug%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fmtunique.com%2fposts%2fdocker_debug%2f&text=Docker%20%e8%b0%83%e8%af%95%e6%8a%80%e5%b7%a7" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fmtunique.com%2fposts%2fdocker_debug%2f&title=Docker%20%e8%b0%83%e8%af%95%e6%8a%80%e5%b7%a7" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fmtunique.com%2fposts%2fdocker_debug%2f&is_video=false&description=Docker%20%e8%b0%83%e8%af%95%e6%8a%80%e5%b7%a7" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Docker%20%e8%b0%83%e8%af%95%e6%8a%80%e5%b7%a7&body=Check out this article: https%3a%2f%2fmtunique.com%2fposts%2fdocker_debug%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fmtunique.com%2fposts%2fdocker_debug%2f&title=Docker%20%e8%b0%83%e8%af%95%e6%8a%80%e5%b7%a7" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fmtunique.com%2fposts%2fdocker_debug%2f&title=Docker%20%e8%b0%83%e8%af%95%e6%8a%80%e5%b7%a7" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fmtunique.com%2fposts%2fdocker_debug%2f&name=Docker%20%e8%b0%83%e8%af%95%e6%8a%80%e5%b7%a7&description=%e3%80%8e%e9%87%8d%e7%94%a8%e3%80%8f%e5%ae%b9%e5%99%a8%e5%90%8d%20%e4%bd%86%e6%88%91%e4%bb%ac%e5%9c%a8%e7%bc%96%e5%86%99%2f%e8%b0%83%e8%af%95Dockerfile%e7%9a%84%e6%97%b6%e5%80%99%e6%88%91%e4%bb%ac%e7%bb%8f%e5%b8%b8%e4%bc%9a%e9%87%8d%e5%a4%8d%e4%b9%8b%e5%89%8d%e7%9a%84command%ef%bc%8c%e6%af%94%e5%a6%82%e8%bf%99%e7%a7%8ddocker%20run%20--name%20jstorm-zookeeper%20zookeeper%3a3.4%ef%bc%8c%e7%84%b6%e5%90%8e%e5%b0%b1%e5%ae%b9%e5%99%a8%e5%90%8d%e5%b0%b1%e5%86%b2%e7%aa%81%e4%ba%86%e3%80%82%0a%24%20docker%20run%20--name%20jstorm-zookeeper%20zookeeper%3a3.4%20...%20%24%20docker%20run%20--name%20jstorm-zookeeper%20zookeeper%3a3.4%20docker%3a%20Error%20response%20from%20daemon%3a%20Conflict.%20The%20name%20%26%2334%3b%2fjstorm-zookeeper%26%2334%3b%20is%20already%20in%20use%20by%20container%20xxxxxxxxx%20%e5%8f%af%e4%bb%a5%e5%9c%a8%e8%bf%90%e8%a1%8c%20docker%20run%20%e6%97%b6%e5%80%99%e5%8a%a0%e4%b8%8a--rm%20flag%2c%20%e5%ae%b9%e5%99%a8%e5%b0%86%e5%9c%a8%e9%80%80%e5%87%ba%e4%b9%8b%e5%90%8e%e9%94%80%e6%af%81%e3%80%82%e6%97%a0%e9%9c%80%e6%89%8b%e5%8a%a8docker%20rm%20CONTAINER%0a%24%20docker%20run%20--name%20jstorm-zookeeper%20zookeeper%3a3.4%20--rm%20%23%20reuse%20%20%24%20docker%20create%20--name%20jstorm-zookeeper%20zookeeper%3a3.4%20%24%20docker%20start%20jstorm-zookeeper%20%23%20no%20error%20debug%20Dockerfile%20%e5%9c%a8%e5%86%99%20Dockerfile%20%e7%9a%84%e6%97%b6%e5%80%99%ef%bc%8c%e9%80%9a%e5%b8%b8%e5%b9%b6%e4%b8%8d%e4%bc%9a%e4%b8%80%e6%b0%94%e5%91%b5%e6%88%90%e3%80%82%e6%9c%89%e7%9a%84%e6%97%b6%e5%80%99%e5%ae%b9%e5%99%a8%e5%90%af%e5%8a%a8%e5%b0%b1crash%20%e7%9b%b4%e6%8e%a5%e9%80%80%e5%87%ba%ef%bc%8c%e6%9c%89%e7%9a%84%e6%97%b6%e5%80%99build%20image%20%e5%b0%b1%e4%bc%9a%e5%a4%b1%e8%b4%a5%ef%bc%8c%e6%88%96%e8%80%85%e6%83%b3%e9%aa%8c%e8%af%81Dockerfile%e6%98%af%e5%90%a6%e7%ac%a6%e5%90%88%e9%a2%84%e6%9c%9f%ef%bc%8c%e6%88%91%e4%bb%ac%e7%bb%8f%e5%b8%b8%e8%a6%81debug%20Dockerfile%e3%80%82" aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fmtunique.com%2fposts%2fdocker_debug%2f&t=Docker%20%e8%b0%83%e8%af%95%e6%8a%80%e5%b7%a7" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick="return $('#nav-footer').toggle(),!1" aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick="return $('#toc-footer').toggle(),!1" aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick="return $('#share-footer').toggle(),!1" aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2021 mtunique</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script></html>