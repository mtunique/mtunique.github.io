<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Flink Table/SQL API 规划 —— Dynamic Table | mtunique blog</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Flink Table/SQL API 规划 —— Dynamic Table"><meta property="og:description" content="动态表的概念是社区很早就提出的但并没有全部实现下文中所有介绍都是基于已有规划和proposal给出的，可能与之后实现存在出入仅供参考 概念 动态表直观上看是一个类似于数据库中的Materialized View概念。动态表随着时间改变；类似静态的batch table一样可以用标准SQL进行查询然后一个新的动态表；可以和流无损地互相转换(对偶的)。对现有的API最大的改进关键在表的内容随着时间改变，而现在的状态只是append。当前的streaming table可以认为是一种动态表，append模式的动态表。
流到 Dynamic Table 流被转换成Table时决定选择哪种模式是依据表的schema是否定义primary key。
Append模式： 如果表的schema没有包括key的定义那转换成表时采用append模式。把流中每条新来的record当做新的row append到表中。一旦数据加到表中就不能再被更新和删除(指当前表中，不考虑转换成新表)。
Replace模式： 相对应，如果定义了key，那么对于流中的每条记录如果key不在表中就insert否则就update。
Dynamic Table 到 流 表到流的操作是把表的所有change以changelog stream的方式发送到下游。这一步也有两种模式。
Retraction模式： traction模式中对于Dynamic Table的insert和delete的change分别产生insert或delete event。如果是update的change会产生两种change event，对于之前发送出去的同样key的record会产生delete event，对于当前的record是产生insert event。如下图所示：
Update模式： update模式依赖Dynamic Table定义了key。所有的change event是一个kv对。key对应表的key在当前record中的值；对于insert和change value对应新的record。对于delete value是空表示该可以已经被删除。如下图所示：
example 表的内容随着时间改变意味着对表的query结果也是随着时间改变的。我们定义：
 A[t]: 时间t时的表A q(A[t])：时间t时对表A执行query q  举个例子来理解动态表的概念：
query的限制 由于流是无限的，相对应 Dynamic Table 也是无界的。当查询无限的表的时候我们需要保证query的定时是良好的，有意义可行的。
1.在实践中Flink将查询转换成持续的流式应用，执行的query仅针对当前的逻辑时间，所以不支持对于任意时间点的查询(A[t])。 2.最直观的原则是query可能的状态和计算必须是有界的，所以可以支持可增量计算的查询：
 不断更新当前结果的查询：查询可以产生insert，update和delete更改。查询可以表示为 Q(t+1) = q'(Q(t), c(T, t, t+1))，其中Q(t)是query q的前一次查询结果，c(T, t, t_+1) 是表T从t+1到t的变化, q&rsquo;是q的增量版本。 产生append-only的表，可以从输入表的尾端直接计算出新数据。查询可以表示为 Q(t+1) = q''(c(T, t-x, t+1)) ∪ Q(t)，q'&lsquo;是不需要时间t时q的结果增量版本query q。c(T, t-x, t+1)是表T尾部的x+1个数据，x取决于语义。例如最后一小时的window aggregation至少需要最后一小时的数据作为状态。其他能支持的查询类型还有：单独在每一行上操作的SELECT WHERE；rowtime上的GROUP BY子句（比如基于时间的window aggregate）；ORDER BY rowtime的OVER windows(row-windows)；ORDER BY rowtime。 3."><meta property="og:type" content="article"><meta property="og:url" content="https://mtunique.com/posts/flink_sql_outlook/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-03-26T22:30:27+08:00"><meta property="article:modified_time" content="2017-03-26T22:30:27+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Flink Table/SQL API 规划 —— Dynamic Table"><meta name=twitter:description content="动态表的概念是社区很早就提出的但并没有全部实现下文中所有介绍都是基于已有规划和proposal给出的，可能与之后实现存在出入仅供参考 概念 动态表直观上看是一个类似于数据库中的Materialized View概念。动态表随着时间改变；类似静态的batch table一样可以用标准SQL进行查询然后一个新的动态表；可以和流无损地互相转换(对偶的)。对现有的API最大的改进关键在表的内容随着时间改变，而现在的状态只是append。当前的streaming table可以认为是一种动态表，append模式的动态表。
流到 Dynamic Table 流被转换成Table时决定选择哪种模式是依据表的schema是否定义primary key。
Append模式： 如果表的schema没有包括key的定义那转换成表时采用append模式。把流中每条新来的record当做新的row append到表中。一旦数据加到表中就不能再被更新和删除(指当前表中，不考虑转换成新表)。
Replace模式： 相对应，如果定义了key，那么对于流中的每条记录如果key不在表中就insert否则就update。
Dynamic Table 到 流 表到流的操作是把表的所有change以changelog stream的方式发送到下游。这一步也有两种模式。
Retraction模式： traction模式中对于Dynamic Table的insert和delete的change分别产生insert或delete event。如果是update的change会产生两种change event，对于之前发送出去的同样key的record会产生delete event，对于当前的record是产生insert event。如下图所示：
Update模式： update模式依赖Dynamic Table定义了key。所有的change event是一个kv对。key对应表的key在当前record中的值；对于insert和change value对应新的record。对于delete value是空表示该可以已经被删除。如下图所示：
example 表的内容随着时间改变意味着对表的query结果也是随着时间改变的。我们定义：
 A[t]: 时间t时的表A q(A[t])：时间t时对表A执行query q  举个例子来理解动态表的概念：
query的限制 由于流是无限的，相对应 Dynamic Table 也是无界的。当查询无限的表的时候我们需要保证query的定时是良好的，有意义可行的。
1.在实践中Flink将查询转换成持续的流式应用，执行的query仅针对当前的逻辑时间，所以不支持对于任意时间点的查询(A[t])。 2.最直观的原则是query可能的状态和计算必须是有界的，所以可以支持可增量计算的查询：
 不断更新当前结果的查询：查询可以产生insert，update和delete更改。查询可以表示为 Q(t+1) = q'(Q(t), c(T, t, t+1))，其中Q(t)是query q的前一次查询结果，c(T, t, t_+1) 是表T从t+1到t的变化, q&rsquo;是q的增量版本。 产生append-only的表，可以从输入表的尾端直接计算出新数据。查询可以表示为 Q(t+1) = q''(c(T, t-x, t+1)) ∪ Q(t)，q'&lsquo;是不需要时间t时q的结果增量版本query q。c(T, t-x, t+1)是表T尾部的x+1个数据，x取决于语义。例如最后一小时的window aggregation至少需要最后一小时的数据作为状态。其他能支持的查询类型还有：单独在每一行上操作的SELECT WHERE；rowtime上的GROUP BY子句（比如基于时间的window aggregate）；ORDER BY rowtime的OVER windows(row-windows)；ORDER BY rowtime。 3."><link rel=stylesheet href=https://mtunique.com/css/style-dark.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://mtunique.com/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast')" style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://mtunique.com/posts/flink_sql/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle()" onmouseout="$('#i-prev').toggle()"></i></a></li><li><a class=icon href=https://mtunique.com/about/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle()" onmouseout="$('#i-next').toggle()"></i></a></li><li><a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle()" onmouseout="$('#i-top').toggle()"></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle()" onmouseout="$('#i-share').toggle()" onclick="return $('#share').toggle(),!1"></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fmtunique.com%2fposts%2fflink_sql_outlook%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fmtunique.com%2fposts%2fflink_sql_outlook%2f&text=Flink%20Table%2fSQL%20API%20%e8%a7%84%e5%88%92%20%e2%80%94%e2%80%94%20Dynamic%20Table" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fmtunique.com%2fposts%2fflink_sql_outlook%2f&title=Flink%20Table%2fSQL%20API%20%e8%a7%84%e5%88%92%20%e2%80%94%e2%80%94%20Dynamic%20Table" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fmtunique.com%2fposts%2fflink_sql_outlook%2f&is_video=false&description=Flink%20Table%2fSQL%20API%20%e8%a7%84%e5%88%92%20%e2%80%94%e2%80%94%20Dynamic%20Table" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Flink%20Table%2fSQL%20API%20%e8%a7%84%e5%88%92%20%e2%80%94%e2%80%94%20Dynamic%20Table&body=Check out this article: https%3a%2f%2fmtunique.com%2fposts%2fflink_sql_outlook%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fmtunique.com%2fposts%2fflink_sql_outlook%2f&title=Flink%20Table%2fSQL%20API%20%e8%a7%84%e5%88%92%20%e2%80%94%e2%80%94%20Dynamic%20Table" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fmtunique.com%2fposts%2fflink_sql_outlook%2f&title=Flink%20Table%2fSQL%20API%20%e8%a7%84%e5%88%92%20%e2%80%94%e2%80%94%20Dynamic%20Table" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fmtunique.com%2fposts%2fflink_sql_outlook%2f&name=Flink%20Table%2fSQL%20API%20%e8%a7%84%e5%88%92%20%e2%80%94%e2%80%94%20Dynamic%20Table&description=%e5%8a%a8%e6%80%81%e8%a1%a8%e7%9a%84%e6%a6%82%e5%bf%b5%e6%98%af%e7%a4%be%e5%8c%ba%e5%be%88%e6%97%a9%e5%b0%b1%e6%8f%90%e5%87%ba%e7%9a%84%e4%bd%86%e5%b9%b6%e6%b2%a1%e6%9c%89%e5%85%a8%e9%83%a8%e5%ae%9e%e7%8e%b0%e4%b8%8b%e6%96%87%e4%b8%ad%e6%89%80%e6%9c%89%e4%bb%8b%e7%bb%8d%e9%83%bd%e6%98%af%e5%9f%ba%e4%ba%8e%e5%b7%b2%e6%9c%89%e8%a7%84%e5%88%92%e5%92%8cproposal%e7%bb%99%e5%87%ba%e7%9a%84%ef%bc%8c%e5%8f%af%e8%83%bd%e4%b8%8e%e4%b9%8b%e5%90%8e%e5%ae%9e%e7%8e%b0%e5%ad%98%e5%9c%a8%e5%87%ba%e5%85%a5%e4%bb%85%e4%be%9b%e5%8f%82%e8%80%83%20%e6%a6%82%e5%bf%b5%20%e5%8a%a8%e6%80%81%e8%a1%a8%e7%9b%b4%e8%a7%82%e4%b8%8a%e7%9c%8b%e6%98%af%e4%b8%80%e4%b8%aa%e7%b1%bb%e4%bc%bc%e4%ba%8e%e6%95%b0%e6%8d%ae%e5%ba%93%e4%b8%ad%e7%9a%84Materialized%20View%e6%a6%82%e5%bf%b5%e3%80%82%e5%8a%a8%e6%80%81%e8%a1%a8%e9%9a%8f%e7%9d%80%e6%97%b6%e9%97%b4%e6%94%b9%e5%8f%98%ef%bc%9b%e7%b1%bb%e4%bc%bc%e9%9d%99%e6%80%81%e7%9a%84batch%20table%e4%b8%80%e6%a0%b7%e5%8f%af%e4%bb%a5%e7%94%a8%e6%a0%87%e5%87%86SQL%e8%bf%9b%e8%a1%8c%e6%9f%a5%e8%af%a2%e7%84%b6%e5%90%8e%e4%b8%80%e4%b8%aa%e6%96%b0%e7%9a%84%e5%8a%a8%e6%80%81%e8%a1%a8%ef%bc%9b%e5%8f%af%e4%bb%a5%e5%92%8c%e6%b5%81%e6%97%a0%e6%8d%9f%e5%9c%b0%e4%ba%92%e7%9b%b8%e8%bd%ac%e6%8d%a2%28%e5%af%b9%e5%81%b6%e7%9a%84%29%e3%80%82%e5%af%b9%e7%8e%b0%e6%9c%89%e7%9a%84API%e6%9c%80%e5%a4%a7%e7%9a%84%e6%94%b9%e8%bf%9b%e5%85%b3%e9%94%ae%e5%9c%a8%e8%a1%a8%e7%9a%84%e5%86%85%e5%ae%b9%e9%9a%8f%e7%9d%80%e6%97%b6%e9%97%b4%e6%94%b9%e5%8f%98%ef%bc%8c%e8%80%8c%e7%8e%b0%e5%9c%a8%e7%9a%84%e7%8a%b6%e6%80%81%e5%8f%aa%e6%98%afappend%e3%80%82%e5%bd%93%e5%89%8d%e7%9a%84streaming%20table%e5%8f%af%e4%bb%a5%e8%ae%a4%e4%b8%ba%e6%98%af%e4%b8%80%e7%a7%8d%e5%8a%a8%e6%80%81%e8%a1%a8%ef%bc%8cappend%e6%a8%a1%e5%bc%8f%e7%9a%84%e5%8a%a8%e6%80%81%e8%a1%a8%e3%80%82%0a%e6%b5%81%e5%88%b0%20Dynamic%20Table%20%e6%b5%81%e8%a2%ab%e8%bd%ac%e6%8d%a2%e6%88%90Table%e6%97%b6%e5%86%b3%e5%ae%9a%e9%80%89%e6%8b%a9%e5%93%aa%e7%a7%8d%e6%a8%a1%e5%bc%8f%e6%98%af%e4%be%9d%e6%8d%ae%e8%a1%a8%e7%9a%84schema%e6%98%af%e5%90%a6%e5%ae%9a%e4%b9%89primary%20key%e3%80%82%0aAppend%e6%a8%a1%e5%bc%8f%ef%bc%9a%20%e5%a6%82%e6%9e%9c%e8%a1%a8%e7%9a%84schema%e6%b2%a1%e6%9c%89%e5%8c%85%e6%8b%ackey%e7%9a%84%e5%ae%9a%e4%b9%89%e9%82%a3%e8%bd%ac%e6%8d%a2%e6%88%90%e8%a1%a8%e6%97%b6%e9%87%87%e7%94%a8append%e6%a8%a1%e5%bc%8f%e3%80%82%e6%8a%8a%e6%b5%81%e4%b8%ad%e6%af%8f%e6%9d%a1%e6%96%b0%e6%9d%a5%e7%9a%84record%e5%bd%93%e5%81%9a%e6%96%b0%e7%9a%84row%20append%e5%88%b0%e8%a1%a8%e4%b8%ad%e3%80%82%e4%b8%80%e6%97%a6%e6%95%b0%e6%8d%ae%e5%8a%a0%e5%88%b0%e8%a1%a8%e4%b8%ad%e5%b0%b1%e4%b8%8d%e8%83%bd%e5%86%8d%e8%a2%ab%e6%9b%b4%e6%96%b0%e5%92%8c%e5%88%a0%e9%99%a4%28%e6%8c%87%e5%bd%93%e5%89%8d%e8%a1%a8%e4%b8%ad%ef%bc%8c%e4%b8%8d%e8%80%83%e8%99%91%e8%bd%ac%e6%8d%a2%e6%88%90%e6%96%b0%e8%a1%a8%29%e3%80%82%0aReplace%e6%a8%a1%e5%bc%8f%ef%bc%9a%20%e7%9b%b8%e5%af%b9%e5%ba%94%ef%bc%8c%e5%a6%82%e6%9e%9c%e5%ae%9a%e4%b9%89%e4%ba%86key%ef%bc%8c%e9%82%a3%e4%b9%88%e5%af%b9%e4%ba%8e%e6%b5%81%e4%b8%ad%e7%9a%84%e6%af%8f%e6%9d%a1%e8%ae%b0%e5%bd%95%e5%a6%82%e6%9e%9ckey%e4%b8%8d%e5%9c%a8%e8%a1%a8%e4%b8%ad%e5%b0%b1insert%e5%90%a6%e5%88%99%e5%b0%b1update%e3%80%82%0aDynamic%20Table%20%e5%88%b0%20%e6%b5%81%20%e8%a1%a8%e5%88%b0%e6%b5%81%e7%9a%84%e6%93%8d%e4%bd%9c%e6%98%af%e6%8a%8a%e8%a1%a8%e7%9a%84%e6%89%80%e6%9c%89change%e4%bb%a5changelog%20stream%e7%9a%84%e6%96%b9%e5%bc%8f%e5%8f%91%e9%80%81%e5%88%b0%e4%b8%8b%e6%b8%b8%e3%80%82%e8%bf%99%e4%b8%80%e6%ad%a5%e4%b9%9f%e6%9c%89%e4%b8%a4%e7%a7%8d%e6%a8%a1%e5%bc%8f%e3%80%82%0aRetraction%e6%a8%a1%e5%bc%8f%ef%bc%9a%20traction%e6%a8%a1%e5%bc%8f%e4%b8%ad%e5%af%b9%e4%ba%8eDynamic%20Table%e7%9a%84insert%e5%92%8cdelete%e7%9a%84change%e5%88%86%e5%88%ab%e4%ba%a7%e7%94%9finsert%e6%88%96delete%20event%e3%80%82%e5%a6%82%e6%9e%9c%e6%98%afupdate%e7%9a%84change%e4%bc%9a%e4%ba%a7%e7%94%9f%e4%b8%a4%e7%a7%8dchange%20event%ef%bc%8c%e5%af%b9%e4%ba%8e%e4%b9%8b%e5%89%8d%e5%8f%91%e9%80%81%e5%87%ba%e5%8e%bb%e7%9a%84%e5%90%8c%e6%a0%b7key%e7%9a%84record%e4%bc%9a%e4%ba%a7%e7%94%9fdelete%20event%ef%bc%8c%e5%af%b9%e4%ba%8e%e5%bd%93%e5%89%8d%e7%9a%84record%e6%98%af%e4%ba%a7%e7%94%9finsert%20event%e3%80%82%e5%a6%82%e4%b8%8b%e5%9b%be%e6%89%80%e7%a4%ba%ef%bc%9a%0aUpdate%e6%a8%a1%e5%bc%8f%ef%bc%9a%20update%e6%a8%a1%e5%bc%8f%e4%be%9d%e8%b5%96Dynamic%20Table%e5%ae%9a%e4%b9%89%e4%ba%86key%e3%80%82%e6%89%80%e6%9c%89%e7%9a%84change%20event%e6%98%af%e4%b8%80%e4%b8%aakv%e5%af%b9%e3%80%82key%e5%af%b9%e5%ba%94%e8%a1%a8%e7%9a%84key%e5%9c%a8%e5%bd%93%e5%89%8drecord%e4%b8%ad%e7%9a%84%e5%80%bc%ef%bc%9b%e5%af%b9%e4%ba%8einsert%e5%92%8cchange%20value%e5%af%b9%e5%ba%94%e6%96%b0%e7%9a%84record%e3%80%82%e5%af%b9%e4%ba%8edelete%20value%e6%98%af%e7%a9%ba%e8%a1%a8%e7%a4%ba%e8%af%a5%e5%8f%af%e4%bb%a5%e5%b7%b2%e7%bb%8f%e8%a2%ab%e5%88%a0%e9%99%a4%e3%80%82%e5%a6%82%e4%b8%8b%e5%9b%be%e6%89%80%e7%a4%ba%ef%bc%9a%0aexample%20%e8%a1%a8%e7%9a%84%e5%86%85%e5%ae%b9%e9%9a%8f%e7%9d%80%e6%97%b6%e9%97%b4%e6%94%b9%e5%8f%98%e6%84%8f%e5%91%b3%e7%9d%80%e5%af%b9%e8%a1%a8%e7%9a%84query%e7%bb%93%e6%9e%9c%e4%b9%9f%e6%98%af%e9%9a%8f%e7%9d%80%e6%97%b6%e9%97%b4%e6%94%b9%e5%8f%98%e7%9a%84%e3%80%82%e6%88%91%e4%bb%ac%e5%ae%9a%e4%b9%89%ef%bc%9a%0a%20A%5bt%5d%3a%20%e6%97%b6%e9%97%b4t%e6%97%b6%e7%9a%84%e8%a1%a8A%20q%28A%5bt%5d%29%ef%bc%9a%e6%97%b6%e9%97%b4t%e6%97%b6%e5%af%b9%e8%a1%a8A%e6%89%a7%e8%a1%8cquery%20q%20%20%e4%b8%be%e4%b8%aa%e4%be%8b%e5%ad%90%e6%9d%a5%e7%90%86%e8%a7%a3%e5%8a%a8%e6%80%81%e8%a1%a8%e7%9a%84%e6%a6%82%e5%bf%b5%ef%bc%9a%0aquery%e7%9a%84%e9%99%90%e5%88%b6%20%e7%94%b1%e4%ba%8e%e6%b5%81%e6%98%af%e6%97%a0%e9%99%90%e7%9a%84%ef%bc%8c%e7%9b%b8%e5%af%b9%e5%ba%94%20Dynamic%20Table%20%e4%b9%9f%e6%98%af%e6%97%a0%e7%95%8c%e7%9a%84%e3%80%82%e5%bd%93%e6%9f%a5%e8%af%a2%e6%97%a0%e9%99%90%e7%9a%84%e8%a1%a8%e7%9a%84%e6%97%b6%e5%80%99%e6%88%91%e4%bb%ac%e9%9c%80%e8%a6%81%e4%bf%9d%e8%af%81query%e7%9a%84%e5%ae%9a%e6%97%b6%e6%98%af%e8%89%af%e5%a5%bd%e7%9a%84%ef%bc%8c%e6%9c%89%e6%84%8f%e4%b9%89%e5%8f%af%e8%a1%8c%e7%9a%84%e3%80%82%0a1.%e5%9c%a8%e5%ae%9e%e8%b7%b5%e4%b8%adFlink%e5%b0%86%e6%9f%a5%e8%af%a2%e8%bd%ac%e6%8d%a2%e6%88%90%e6%8c%81%e7%bb%ad%e7%9a%84%e6%b5%81%e5%bc%8f%e5%ba%94%e7%94%a8%ef%bc%8c%e6%89%a7%e8%a1%8c%e7%9a%84query%e4%bb%85%e9%92%88%e5%af%b9%e5%bd%93%e5%89%8d%e7%9a%84%e9%80%bb%e8%be%91%e6%97%b6%e9%97%b4%ef%bc%8c%e6%89%80%e4%bb%a5%e4%b8%8d%e6%94%af%e6%8c%81%e5%af%b9%e4%ba%8e%e4%bb%bb%e6%84%8f%e6%97%b6%e9%97%b4%e7%82%b9%e7%9a%84%e6%9f%a5%e8%af%a2%28A%5bt%5d%29%e3%80%82%202.%e6%9c%80%e7%9b%b4%e8%a7%82%e7%9a%84%e5%8e%9f%e5%88%99%e6%98%afquery%e5%8f%af%e8%83%bd%e7%9a%84%e7%8a%b6%e6%80%81%e5%92%8c%e8%ae%a1%e7%ae%97%e5%bf%85%e9%a1%bb%e6%98%af%e6%9c%89%e7%95%8c%e7%9a%84%ef%bc%8c%e6%89%80%e4%bb%a5%e5%8f%af%e4%bb%a5%e6%94%af%e6%8c%81%e5%8f%af%e5%a2%9e%e9%87%8f%e8%ae%a1%e7%ae%97%e7%9a%84%e6%9f%a5%e8%af%a2%ef%bc%9a%0a%20%e4%b8%8d%e6%96%ad%e6%9b%b4%e6%96%b0%e5%bd%93%e5%89%8d%e7%bb%93%e6%9e%9c%e7%9a%84%e6%9f%a5%e8%af%a2%ef%bc%9a%e6%9f%a5%e8%af%a2%e5%8f%af%e4%bb%a5%e4%ba%a7%e7%94%9finsert%ef%bc%8cupdate%e5%92%8cdelete%e6%9b%b4%e6%94%b9%e3%80%82%e6%9f%a5%e8%af%a2%e5%8f%af%e4%bb%a5%e8%a1%a8%e7%a4%ba%e4%b8%ba%20Q%28t%2b1%29%20%3d%20q%27%28Q%28t%29%2c%20c%28T%2c%20t%2c%20t%2b1%29%29%ef%bc%8c%e5%85%b6%e4%b8%adQ%28t%29%e6%98%afquery%20q%e7%9a%84%e5%89%8d%e4%b8%80%e6%ac%a1%e6%9f%a5%e8%af%a2%e7%bb%93%e6%9e%9c%ef%bc%8cc%28T%2c%20t%2c%20t_%2b1%29%20%e6%98%af%e8%a1%a8T%e4%bb%8et%2b1%e5%88%b0t%e7%9a%84%e5%8f%98%e5%8c%96%2c%20q%26rsquo%3b%e6%98%afq%e7%9a%84%e5%a2%9e%e9%87%8f%e7%89%88%e6%9c%ac%e3%80%82%20%e4%ba%a7%e7%94%9fappend-only%e7%9a%84%e8%a1%a8%ef%bc%8c%e5%8f%af%e4%bb%a5%e4%bb%8e%e8%be%93%e5%85%a5%e8%a1%a8%e7%9a%84%e5%b0%be%e7%ab%af%e7%9b%b4%e6%8e%a5%e8%ae%a1%e7%ae%97%e5%87%ba%e6%96%b0%e6%95%b0%e6%8d%ae%e3%80%82%e6%9f%a5%e8%af%a2%e5%8f%af%e4%bb%a5%e8%a1%a8%e7%a4%ba%e4%b8%ba%20Q%28t%2b1%29%20%3d%20q%27%27%28c%28T%2c%20t-x%2c%20t%2b1%29%29%20%e2%88%aa%20Q%28t%29%ef%bc%8cq%27%26lsquo%3b%e6%98%af%e4%b8%8d%e9%9c%80%e8%a6%81%e6%97%b6%e9%97%b4t%e6%97%b6q%e7%9a%84%e7%bb%93%e6%9e%9c%e5%a2%9e%e9%87%8f%e7%89%88%e6%9c%acquery%20q%e3%80%82c%28T%2c%20t-x%2c%20t%2b1%29%e6%98%af%e8%a1%a8T%e5%b0%be%e9%83%a8%e7%9a%84x%2b1%e4%b8%aa%e6%95%b0%e6%8d%ae%ef%bc%8cx%e5%8f%96%e5%86%b3%e4%ba%8e%e8%af%ad%e4%b9%89%e3%80%82%e4%be%8b%e5%a6%82%e6%9c%80%e5%90%8e%e4%b8%80%e5%b0%8f%e6%97%b6%e7%9a%84window%20aggregation%e8%87%b3%e5%b0%91%e9%9c%80%e8%a6%81%e6%9c%80%e5%90%8e%e4%b8%80%e5%b0%8f%e6%97%b6%e7%9a%84%e6%95%b0%e6%8d%ae%e4%bd%9c%e4%b8%ba%e7%8a%b6%e6%80%81%e3%80%82%e5%85%b6%e4%bb%96%e8%83%bd%e6%94%af%e6%8c%81%e7%9a%84%e6%9f%a5%e8%af%a2%e7%b1%bb%e5%9e%8b%e8%bf%98%e6%9c%89%ef%bc%9a%e5%8d%95%e7%8b%ac%e5%9c%a8%e6%af%8f%e4%b8%80%e8%a1%8c%e4%b8%8a%e6%93%8d%e4%bd%9c%e7%9a%84SELECT%20WHERE%ef%bc%9browtime%e4%b8%8a%e7%9a%84GROUP%20BY%e5%ad%90%e5%8f%a5%ef%bc%88%e6%af%94%e5%a6%82%e5%9f%ba%e4%ba%8e%e6%97%b6%e9%97%b4%e7%9a%84window%20aggregate%ef%bc%89%ef%bc%9bORDER%20BY%20rowtime%e7%9a%84OVER%20windows%28row-windows%29%ef%bc%9bORDER%20BY%20rowtime%e3%80%82%203." aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fmtunique.com%2fposts%2fflink_sql_outlook%2f&t=Flink%20Table%2fSQL%20API%20%e8%a7%84%e5%88%92%20%e2%80%94%e2%80%94%20Dynamic%20Table" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><a href=#概念>概念</a></li><li><a href=#流到-dynamic-table>流到 Dynamic Table</a><ul><li><a href=#append模式>Append模式：</a></li><li><a href=#replace模式>Replace模式：</a></li></ul></li><li><a href=#dynamic-table-到-流>Dynamic Table 到 流</a><ul><li><a href=#retraction模式>Retraction模式：</a></li><li><a href=#update模式>Update模式：</a></li></ul></li><li><a href=#example>example</a></li><li><a href=#query的限制>query的限制</a></li><li><a href=#中间状态有界>中间状态有界</a></li><li><a href=#结果的计算和细化时序>结果的计算和细化时序</a></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Flink Table/SQL API 规划 —— Dynamic Table</h1><div class=meta><div class=postdate><time datetime="2017-03-26 22:30:27 +0800 +0800" itemprop=datePublished>2017-03-26</time></div><div class=article-category><i class="fas fa-archive"></i>
<a class=category-link href=/categories/big-data>big-data</a>
,
<a class=category-link href=/categories/flink>flink</a></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/big-data rel=tag>big-data</a>
,
<a class=tag-link href=/tags/flink rel=tag>flink</a></div></div></header><div class=content itemprop=articleBody><pre><code>动态表的概念是社区很早就提出的但并没有全部实现下文中所有介绍都是基于已有规划和proposal给出的，可能与之后实现存在出入仅供参考
</code></pre><p><img src=https://dn-mtunique.qbox.me/dyn_table_pipline.jpg alt></p><h2 id=概念>概念</h2><p>动态表直观上看是一个类似于数据库中的<code>Materialized View</code>概念。动态表随着时间改变；类似静态的batch table一样可以用标准SQL进行查询然后一个新的动态表；可以和流无损地互相转换(对偶的)。对现有的API最大的改进关键在表的内容随着时间改变，而现在的状态只是append。当前的streaming table可以认为是一种动态表，append模式的动态表。</p><h2 id=流到-dynamic-table>流到 Dynamic Table</h2><p>流被转换成Table时决定选择哪种模式是依据表的schema是否定义primary key。</p><h3 id=append模式>Append模式：</h3><p>如果表的schema没有包括key的定义那转换成表时采用append模式。把流中每条新来的record当做新的row append到表中。一旦数据加到表中就不能再被更新和删除(指当前表中，不考虑转换成新表)。</p><p><img src=https://dn-mtunique.qbox.me/stream2t_append.jpg alt></p><h3 id=replace模式>Replace模式：</h3><p>相对应，如果定义了key，那么对于流中的每条记录如果key不在表中就insert否则就update。</p><p><img src=https://dn-mtunique.qbox.me/stream2t_replace.jpg alt></p><h2 id=dynamic-table-到-流>Dynamic Table 到 流</h2><p>表到流的操作是把表的所有change以changelog stream的方式发送到下游。这一步也有两种模式。</p><h3 id=retraction模式>Retraction模式：</h3><p>traction模式中对于Dynamic Table的insert和delete的change分别产生insert或delete event。如果是update的change会产生两种change event，对于之前发送出去的同样key的record会产生delete event，对于当前的record是产生insert event。如下图所示：</p><p><img src=https://dn-mtunique.qbox.me/t2stream_retract.jpg alt></p><h3 id=update模式>Update模式：</h3><p>update模式依赖Dynamic Table定义了key。所有的change event是一个kv对。key对应表的key在当前record中的值；对于insert和change value对应新的record。对于delete value是空表示该可以已经被删除。如下图所示：</p><p><img src=https://dn-mtunique.qbox.me/t2stream_replace.jpg alt></p><h2 id=example>example</h2><p>表的内容随着时间改变意味着对表的query结果也是随着时间改变的。我们定义：</p><ul><li>A[t]: 时间t时的表A</li><li>q(A[t])：时间t时对表A执行query q</li></ul><p>举个例子来理解动态表的概念：</p><p><img src=https://dn-mtunique.qbox.me/dyn_table_example.jpg alt></p><h2 id=query的限制>query的限制</h2><p>由于流是无限的，相对应 Dynamic Table 也是无界的。当查询无限的表的时候我们需要保证query的定时是良好的，有意义可行的。</p><p>1.在实践中Flink将查询转换成持续的流式应用，执行的query仅针对当前的逻辑时间，所以不支持对于任意时间点的查询(A[t])。
2.最直观的原则是query可能的状态和计算必须是有界的，所以可以支持可增量计算的查询：</p><ul><li>不断更新当前结果的查询：查询可以产生insert，update和delete更改。查询可以表示为 <code>Q(t+1) = q'(Q(t), c(T, t, t+1))</code>，其中Q(t)是query q的前一次查询结果，c(T, t, t_+1) 是表T从t+1到t的变化, q&rsquo;是q的增量版本。</li><li>产生append-only的表，可以从输入表的尾端直接计算出新数据。查询可以表示为 <code>Q(t+1) = q''(c(T, t-x, t+1)) ∪ Q(t)</code>，q'&lsquo;是不需要时间t时q的结果增量版本query q。c(T, t-x, t+1)是表T尾部的x+1个数据，x取决于语义。例如最后一小时的window aggregation至少需要最后一小时的数据作为状态。其他能支持的查询类型还有：单独在每一行上操作的SELECT WHERE；rowtime上的GROUP BY子句（比如基于时间的window aggregate）；ORDER BY rowtime的OVER windows(row-windows)；ORDER BY rowtime。
3.当输入表足够小时，对表的每条数据进行访问。比如对两个大小固定的流表(比如key的个数固定)进行join。</li></ul><h2 id=中间状态有界>中间状态有界</h2><p>如上文所说的，某些增量查询需要保留一些数据（部分输入数据或者中间结果）作为状态。为了保证query不会失败，保证查询所需要的空间是有界的不随着时间无限增长很重要。主要有两个原因使得状态增长：</p><ol><li>不受时间谓词约束的中间计算状态的增长（比如 聚合key的膨胀）</li><li>时间有界但是需要迟到的数据（比如 window 的聚合）</li></ol><p>虽然第二种情况可有通过下文提到的"Last Result Offset"参数解决，但是第一种情况需要优化器检测。我们应该拒绝不受时间限制的中间状态增长的查询。优化器应该提供如何修复查询且要求有适当的时间谓词。比如下面这个查询：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>user</span>, page, <span style=color:#66d9ef>COUNT</span>(page) <span style=color:#66d9ef>AS</span> pCnt
<span style=color:#66d9ef>FROM</span> pageviews
<span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> <span style=color:#66d9ef>user</span>, page
</code></pre></div><p>随着用户数和页面数的增长，中间状态会数据随着时间推移而增长。对于存储空间的要求可以通过添加时间谓词来限制：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>user</span>, page, <span style=color:#66d9ef>COUNT</span>(page) <span style=color:#66d9ef>AS</span> pCnt
<span style=color:#66d9ef>FROM</span> pageviews
<span style=color:#66d9ef>WHERE</span> rowtime <span style=color:#66d9ef>BETWEEN</span> now() <span style=color:#f92672>-</span> INTERVAL <span style=color:#e6db74>&#39;1&#39;</span> HOUR <span style=color:#66d9ef>AND</span> now() <span style=color:#f92672>//</span> <span style=color:#66d9ef>only</span> <span style=color:#66d9ef>last</span> hour
<span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> <span style=color:#66d9ef>user</span>, page
</code></pre></div><p>因为不是所有属性都是不断增长的, 因此可以告诉优化器domain的size, 就可以推断中间状态不会随着时间推移而增长，然后接受没有时间谓词的查询。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>val</span> sensorT<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Table</span> <span style=color:#f92672>=</span> sensors
  <span style=color:#f92672>.</span>toTable<span style=color:#f92672>(</span>&#39;id<span style=color:#f92672>,</span> &#39;loc<span style=color:#f92672>,</span> &#39;stime<span style=color:#f92672>,</span> &#39;temp<span style=color:#f92672>)</span>
  <span style=color:#f92672>.</span>attributeDomain<span style=color:#f92672>(</span>&#39;loc<span style=color:#f92672>,</span> <span style=color:#a6e22e>Domain</span><span style=color:#f92672>.</span>constant<span style=color:#f92672>)</span> <span style=color:#75715e>// domain of &#39;loc is not growing 
</span><span style=color:#75715e></span>env<span style=color:#f92672>.</span>registerTable<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;sensors&#34;</span><span style=color:#f92672>,</span> sensorT<span style=color:#f92672>)</span>

<span style=color:#a6e22e>SELECT</span> loc<span style=color:#f92672>,</span> <span style=color:#a6e22e>AVG</span><span style=color:#f92672>(</span>temp<span style=color:#f92672>)</span> <span style=color:#a6e22e>AS</span> avgTemp
<span style=color:#a6e22e>FROM</span> sensors
<span style=color:#a6e22e>GROUP</span> <span style=color:#a6e22e>BY</span> loc
</code></pre></div><h2 id=结果的计算和细化时序>结果的计算和细化时序</h2><p>一些关系运算符必须等数据到达才能计算最终结果。例如：在10：30关闭的窗口至少要等到10：30才能计算出最终的结果。Flink的logical clock（即 决定何时才是10：30）取决于使用event time 还是 processing time。在processing time的情况下，logical time是每个机器的wallclock；在event time的情况下，logical clock time是由源头提供的watermark决定的。由于数据的乱序和延迟当在event time模式下时等待一段时间来减小计算结果不完整性。另一方面某些情况下希望得到不断改进的早期结果。因此对于结果被计算、改进或者做出最终结果时有不同的要求、</p><p>下图描绘了不同的配置参数如何用于控制早期结果和细化计算结果的。</p><p><img src=https://dn-mtunique.qbox.me/time_conf.jpg alt></p><ul><li>&ldquo;First Result Offset&rdquo; 指第一个早期结果被计算的结果的时间。时间是相对于第一次可以计算完整结果的时间（比如相对于window的结束时间10:30）。如果设置的是-10分钟，对于结束时间是10：30的window那么第一个被发出去的结果是在逻辑时间10：20计算的。这个参数的默认值是0，即在window结束的时候才计算结果。</li><li>&ldquo;Complete Result Offset&rdquo; 指完整的结果被计算的时间。时间是相对于第一次可以计算完整的时间。如果设置的是+5分钟，对于结束时间是10：30的window那么产生完整结果的时间是10：35。这个参数可以减轻延迟数据造成的影响。默认是0，即在window结束的时候计算的结果就是完整结果。</li><li>&ldquo;Update Rate&rdquo; 指计算完整结果之前一次次更新结果的时间间隔（可以是时间和次数）。如果设为5分钟，窗口大小是30分钟的tumbling window，开始时间是10：300，&ldquo;First Result Offset"是-15分钟， &ldquo;Complete Result Offset"是2分钟，那么将在10:20, 10:25, 10：30更新结果，10:15禅城寄一个结果，10：32产生完整结果。</li><li>&ldquo;Last Updates Switch&rdquo; 指完整结果发出后对于延迟的数据是否计算延迟更新，直到计算状态被清除。</li><li>&ldquo;Last Result Offset&rdquo; 指可计算的最后一个结果的时间。这是内部状态被清除的时间，清除状态后再到达的数据将被丢弃。Last Result Offset 意味着计算的结果是近似值，不能保证精确。</li></ul></div></article><div class=blog-post-comments><div id=disqus_thread><script type=text/javascript>(function(){var a=document.createElement('script'),b;a.type='text/javascript',a.async=!0,b='mtunique',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><a href=#概念>概念</a></li><li><a href=#流到-dynamic-table>流到 Dynamic Table</a><ul><li><a href=#append模式>Append模式：</a></li><li><a href=#replace模式>Replace模式：</a></li></ul></li><li><a href=#dynamic-table-到-流>Dynamic Table 到 流</a><ul><li><a href=#retraction模式>Retraction模式：</a></li><li><a href=#update模式>Update模式：</a></li></ul></li><li><a href=#example>example</a></li><li><a href=#query的限制>query的限制</a></li><li><a href=#中间状态有界>中间状态有界</a></li><li><a href=#结果的计算和细化时序>结果的计算和细化时序</a></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fmtunique.com%2fposts%2fflink_sql_outlook%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fmtunique.com%2fposts%2fflink_sql_outlook%2f&text=Flink%20Table%2fSQL%20API%20%e8%a7%84%e5%88%92%20%e2%80%94%e2%80%94%20Dynamic%20Table" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fmtunique.com%2fposts%2fflink_sql_outlook%2f&title=Flink%20Table%2fSQL%20API%20%e8%a7%84%e5%88%92%20%e2%80%94%e2%80%94%20Dynamic%20Table" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fmtunique.com%2fposts%2fflink_sql_outlook%2f&is_video=false&description=Flink%20Table%2fSQL%20API%20%e8%a7%84%e5%88%92%20%e2%80%94%e2%80%94%20Dynamic%20Table" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Flink%20Table%2fSQL%20API%20%e8%a7%84%e5%88%92%20%e2%80%94%e2%80%94%20Dynamic%20Table&body=Check out this article: https%3a%2f%2fmtunique.com%2fposts%2fflink_sql_outlook%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fmtunique.com%2fposts%2fflink_sql_outlook%2f&title=Flink%20Table%2fSQL%20API%20%e8%a7%84%e5%88%92%20%e2%80%94%e2%80%94%20Dynamic%20Table" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fmtunique.com%2fposts%2fflink_sql_outlook%2f&title=Flink%20Table%2fSQL%20API%20%e8%a7%84%e5%88%92%20%e2%80%94%e2%80%94%20Dynamic%20Table" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fmtunique.com%2fposts%2fflink_sql_outlook%2f&name=Flink%20Table%2fSQL%20API%20%e8%a7%84%e5%88%92%20%e2%80%94%e2%80%94%20Dynamic%20Table&description=%e5%8a%a8%e6%80%81%e8%a1%a8%e7%9a%84%e6%a6%82%e5%bf%b5%e6%98%af%e7%a4%be%e5%8c%ba%e5%be%88%e6%97%a9%e5%b0%b1%e6%8f%90%e5%87%ba%e7%9a%84%e4%bd%86%e5%b9%b6%e6%b2%a1%e6%9c%89%e5%85%a8%e9%83%a8%e5%ae%9e%e7%8e%b0%e4%b8%8b%e6%96%87%e4%b8%ad%e6%89%80%e6%9c%89%e4%bb%8b%e7%bb%8d%e9%83%bd%e6%98%af%e5%9f%ba%e4%ba%8e%e5%b7%b2%e6%9c%89%e8%a7%84%e5%88%92%e5%92%8cproposal%e7%bb%99%e5%87%ba%e7%9a%84%ef%bc%8c%e5%8f%af%e8%83%bd%e4%b8%8e%e4%b9%8b%e5%90%8e%e5%ae%9e%e7%8e%b0%e5%ad%98%e5%9c%a8%e5%87%ba%e5%85%a5%e4%bb%85%e4%be%9b%e5%8f%82%e8%80%83%20%e6%a6%82%e5%bf%b5%20%e5%8a%a8%e6%80%81%e8%a1%a8%e7%9b%b4%e8%a7%82%e4%b8%8a%e7%9c%8b%e6%98%af%e4%b8%80%e4%b8%aa%e7%b1%bb%e4%bc%bc%e4%ba%8e%e6%95%b0%e6%8d%ae%e5%ba%93%e4%b8%ad%e7%9a%84Materialized%20View%e6%a6%82%e5%bf%b5%e3%80%82%e5%8a%a8%e6%80%81%e8%a1%a8%e9%9a%8f%e7%9d%80%e6%97%b6%e9%97%b4%e6%94%b9%e5%8f%98%ef%bc%9b%e7%b1%bb%e4%bc%bc%e9%9d%99%e6%80%81%e7%9a%84batch%20table%e4%b8%80%e6%a0%b7%e5%8f%af%e4%bb%a5%e7%94%a8%e6%a0%87%e5%87%86SQL%e8%bf%9b%e8%a1%8c%e6%9f%a5%e8%af%a2%e7%84%b6%e5%90%8e%e4%b8%80%e4%b8%aa%e6%96%b0%e7%9a%84%e5%8a%a8%e6%80%81%e8%a1%a8%ef%bc%9b%e5%8f%af%e4%bb%a5%e5%92%8c%e6%b5%81%e6%97%a0%e6%8d%9f%e5%9c%b0%e4%ba%92%e7%9b%b8%e8%bd%ac%e6%8d%a2%28%e5%af%b9%e5%81%b6%e7%9a%84%29%e3%80%82%e5%af%b9%e7%8e%b0%e6%9c%89%e7%9a%84API%e6%9c%80%e5%a4%a7%e7%9a%84%e6%94%b9%e8%bf%9b%e5%85%b3%e9%94%ae%e5%9c%a8%e8%a1%a8%e7%9a%84%e5%86%85%e5%ae%b9%e9%9a%8f%e7%9d%80%e6%97%b6%e9%97%b4%e6%94%b9%e5%8f%98%ef%bc%8c%e8%80%8c%e7%8e%b0%e5%9c%a8%e7%9a%84%e7%8a%b6%e6%80%81%e5%8f%aa%e6%98%afappend%e3%80%82%e5%bd%93%e5%89%8d%e7%9a%84streaming%20table%e5%8f%af%e4%bb%a5%e8%ae%a4%e4%b8%ba%e6%98%af%e4%b8%80%e7%a7%8d%e5%8a%a8%e6%80%81%e8%a1%a8%ef%bc%8cappend%e6%a8%a1%e5%bc%8f%e7%9a%84%e5%8a%a8%e6%80%81%e8%a1%a8%e3%80%82%0a%e6%b5%81%e5%88%b0%20Dynamic%20Table%20%e6%b5%81%e8%a2%ab%e8%bd%ac%e6%8d%a2%e6%88%90Table%e6%97%b6%e5%86%b3%e5%ae%9a%e9%80%89%e6%8b%a9%e5%93%aa%e7%a7%8d%e6%a8%a1%e5%bc%8f%e6%98%af%e4%be%9d%e6%8d%ae%e8%a1%a8%e7%9a%84schema%e6%98%af%e5%90%a6%e5%ae%9a%e4%b9%89primary%20key%e3%80%82%0aAppend%e6%a8%a1%e5%bc%8f%ef%bc%9a%20%e5%a6%82%e6%9e%9c%e8%a1%a8%e7%9a%84schema%e6%b2%a1%e6%9c%89%e5%8c%85%e6%8b%ackey%e7%9a%84%e5%ae%9a%e4%b9%89%e9%82%a3%e8%bd%ac%e6%8d%a2%e6%88%90%e8%a1%a8%e6%97%b6%e9%87%87%e7%94%a8append%e6%a8%a1%e5%bc%8f%e3%80%82%e6%8a%8a%e6%b5%81%e4%b8%ad%e6%af%8f%e6%9d%a1%e6%96%b0%e6%9d%a5%e7%9a%84record%e5%bd%93%e5%81%9a%e6%96%b0%e7%9a%84row%20append%e5%88%b0%e8%a1%a8%e4%b8%ad%e3%80%82%e4%b8%80%e6%97%a6%e6%95%b0%e6%8d%ae%e5%8a%a0%e5%88%b0%e8%a1%a8%e4%b8%ad%e5%b0%b1%e4%b8%8d%e8%83%bd%e5%86%8d%e8%a2%ab%e6%9b%b4%e6%96%b0%e5%92%8c%e5%88%a0%e9%99%a4%28%e6%8c%87%e5%bd%93%e5%89%8d%e8%a1%a8%e4%b8%ad%ef%bc%8c%e4%b8%8d%e8%80%83%e8%99%91%e8%bd%ac%e6%8d%a2%e6%88%90%e6%96%b0%e8%a1%a8%29%e3%80%82%0aReplace%e6%a8%a1%e5%bc%8f%ef%bc%9a%20%e7%9b%b8%e5%af%b9%e5%ba%94%ef%bc%8c%e5%a6%82%e6%9e%9c%e5%ae%9a%e4%b9%89%e4%ba%86key%ef%bc%8c%e9%82%a3%e4%b9%88%e5%af%b9%e4%ba%8e%e6%b5%81%e4%b8%ad%e7%9a%84%e6%af%8f%e6%9d%a1%e8%ae%b0%e5%bd%95%e5%a6%82%e6%9e%9ckey%e4%b8%8d%e5%9c%a8%e8%a1%a8%e4%b8%ad%e5%b0%b1insert%e5%90%a6%e5%88%99%e5%b0%b1update%e3%80%82%0aDynamic%20Table%20%e5%88%b0%20%e6%b5%81%20%e8%a1%a8%e5%88%b0%e6%b5%81%e7%9a%84%e6%93%8d%e4%bd%9c%e6%98%af%e6%8a%8a%e8%a1%a8%e7%9a%84%e6%89%80%e6%9c%89change%e4%bb%a5changelog%20stream%e7%9a%84%e6%96%b9%e5%bc%8f%e5%8f%91%e9%80%81%e5%88%b0%e4%b8%8b%e6%b8%b8%e3%80%82%e8%bf%99%e4%b8%80%e6%ad%a5%e4%b9%9f%e6%9c%89%e4%b8%a4%e7%a7%8d%e6%a8%a1%e5%bc%8f%e3%80%82%0aRetraction%e6%a8%a1%e5%bc%8f%ef%bc%9a%20traction%e6%a8%a1%e5%bc%8f%e4%b8%ad%e5%af%b9%e4%ba%8eDynamic%20Table%e7%9a%84insert%e5%92%8cdelete%e7%9a%84change%e5%88%86%e5%88%ab%e4%ba%a7%e7%94%9finsert%e6%88%96delete%20event%e3%80%82%e5%a6%82%e6%9e%9c%e6%98%afupdate%e7%9a%84change%e4%bc%9a%e4%ba%a7%e7%94%9f%e4%b8%a4%e7%a7%8dchange%20event%ef%bc%8c%e5%af%b9%e4%ba%8e%e4%b9%8b%e5%89%8d%e5%8f%91%e9%80%81%e5%87%ba%e5%8e%bb%e7%9a%84%e5%90%8c%e6%a0%b7key%e7%9a%84record%e4%bc%9a%e4%ba%a7%e7%94%9fdelete%20event%ef%bc%8c%e5%af%b9%e4%ba%8e%e5%bd%93%e5%89%8d%e7%9a%84record%e6%98%af%e4%ba%a7%e7%94%9finsert%20event%e3%80%82%e5%a6%82%e4%b8%8b%e5%9b%be%e6%89%80%e7%a4%ba%ef%bc%9a%0aUpdate%e6%a8%a1%e5%bc%8f%ef%bc%9a%20update%e6%a8%a1%e5%bc%8f%e4%be%9d%e8%b5%96Dynamic%20Table%e5%ae%9a%e4%b9%89%e4%ba%86key%e3%80%82%e6%89%80%e6%9c%89%e7%9a%84change%20event%e6%98%af%e4%b8%80%e4%b8%aakv%e5%af%b9%e3%80%82key%e5%af%b9%e5%ba%94%e8%a1%a8%e7%9a%84key%e5%9c%a8%e5%bd%93%e5%89%8drecord%e4%b8%ad%e7%9a%84%e5%80%bc%ef%bc%9b%e5%af%b9%e4%ba%8einsert%e5%92%8cchange%20value%e5%af%b9%e5%ba%94%e6%96%b0%e7%9a%84record%e3%80%82%e5%af%b9%e4%ba%8edelete%20value%e6%98%af%e7%a9%ba%e8%a1%a8%e7%a4%ba%e8%af%a5%e5%8f%af%e4%bb%a5%e5%b7%b2%e7%bb%8f%e8%a2%ab%e5%88%a0%e9%99%a4%e3%80%82%e5%a6%82%e4%b8%8b%e5%9b%be%e6%89%80%e7%a4%ba%ef%bc%9a%0aexample%20%e8%a1%a8%e7%9a%84%e5%86%85%e5%ae%b9%e9%9a%8f%e7%9d%80%e6%97%b6%e9%97%b4%e6%94%b9%e5%8f%98%e6%84%8f%e5%91%b3%e7%9d%80%e5%af%b9%e8%a1%a8%e7%9a%84query%e7%bb%93%e6%9e%9c%e4%b9%9f%e6%98%af%e9%9a%8f%e7%9d%80%e6%97%b6%e9%97%b4%e6%94%b9%e5%8f%98%e7%9a%84%e3%80%82%e6%88%91%e4%bb%ac%e5%ae%9a%e4%b9%89%ef%bc%9a%0a%20A%5bt%5d%3a%20%e6%97%b6%e9%97%b4t%e6%97%b6%e7%9a%84%e8%a1%a8A%20q%28A%5bt%5d%29%ef%bc%9a%e6%97%b6%e9%97%b4t%e6%97%b6%e5%af%b9%e8%a1%a8A%e6%89%a7%e8%a1%8cquery%20q%20%20%e4%b8%be%e4%b8%aa%e4%be%8b%e5%ad%90%e6%9d%a5%e7%90%86%e8%a7%a3%e5%8a%a8%e6%80%81%e8%a1%a8%e7%9a%84%e6%a6%82%e5%bf%b5%ef%bc%9a%0aquery%e7%9a%84%e9%99%90%e5%88%b6%20%e7%94%b1%e4%ba%8e%e6%b5%81%e6%98%af%e6%97%a0%e9%99%90%e7%9a%84%ef%bc%8c%e7%9b%b8%e5%af%b9%e5%ba%94%20Dynamic%20Table%20%e4%b9%9f%e6%98%af%e6%97%a0%e7%95%8c%e7%9a%84%e3%80%82%e5%bd%93%e6%9f%a5%e8%af%a2%e6%97%a0%e9%99%90%e7%9a%84%e8%a1%a8%e7%9a%84%e6%97%b6%e5%80%99%e6%88%91%e4%bb%ac%e9%9c%80%e8%a6%81%e4%bf%9d%e8%af%81query%e7%9a%84%e5%ae%9a%e6%97%b6%e6%98%af%e8%89%af%e5%a5%bd%e7%9a%84%ef%bc%8c%e6%9c%89%e6%84%8f%e4%b9%89%e5%8f%af%e8%a1%8c%e7%9a%84%e3%80%82%0a1.%e5%9c%a8%e5%ae%9e%e8%b7%b5%e4%b8%adFlink%e5%b0%86%e6%9f%a5%e8%af%a2%e8%bd%ac%e6%8d%a2%e6%88%90%e6%8c%81%e7%bb%ad%e7%9a%84%e6%b5%81%e5%bc%8f%e5%ba%94%e7%94%a8%ef%bc%8c%e6%89%a7%e8%a1%8c%e7%9a%84query%e4%bb%85%e9%92%88%e5%af%b9%e5%bd%93%e5%89%8d%e7%9a%84%e9%80%bb%e8%be%91%e6%97%b6%e9%97%b4%ef%bc%8c%e6%89%80%e4%bb%a5%e4%b8%8d%e6%94%af%e6%8c%81%e5%af%b9%e4%ba%8e%e4%bb%bb%e6%84%8f%e6%97%b6%e9%97%b4%e7%82%b9%e7%9a%84%e6%9f%a5%e8%af%a2%28A%5bt%5d%29%e3%80%82%202.%e6%9c%80%e7%9b%b4%e8%a7%82%e7%9a%84%e5%8e%9f%e5%88%99%e6%98%afquery%e5%8f%af%e8%83%bd%e7%9a%84%e7%8a%b6%e6%80%81%e5%92%8c%e8%ae%a1%e7%ae%97%e5%bf%85%e9%a1%bb%e6%98%af%e6%9c%89%e7%95%8c%e7%9a%84%ef%bc%8c%e6%89%80%e4%bb%a5%e5%8f%af%e4%bb%a5%e6%94%af%e6%8c%81%e5%8f%af%e5%a2%9e%e9%87%8f%e8%ae%a1%e7%ae%97%e7%9a%84%e6%9f%a5%e8%af%a2%ef%bc%9a%0a%20%e4%b8%8d%e6%96%ad%e6%9b%b4%e6%96%b0%e5%bd%93%e5%89%8d%e7%bb%93%e6%9e%9c%e7%9a%84%e6%9f%a5%e8%af%a2%ef%bc%9a%e6%9f%a5%e8%af%a2%e5%8f%af%e4%bb%a5%e4%ba%a7%e7%94%9finsert%ef%bc%8cupdate%e5%92%8cdelete%e6%9b%b4%e6%94%b9%e3%80%82%e6%9f%a5%e8%af%a2%e5%8f%af%e4%bb%a5%e8%a1%a8%e7%a4%ba%e4%b8%ba%20Q%28t%2b1%29%20%3d%20q%27%28Q%28t%29%2c%20c%28T%2c%20t%2c%20t%2b1%29%29%ef%bc%8c%e5%85%b6%e4%b8%adQ%28t%29%e6%98%afquery%20q%e7%9a%84%e5%89%8d%e4%b8%80%e6%ac%a1%e6%9f%a5%e8%af%a2%e7%bb%93%e6%9e%9c%ef%bc%8cc%28T%2c%20t%2c%20t_%2b1%29%20%e6%98%af%e8%a1%a8T%e4%bb%8et%2b1%e5%88%b0t%e7%9a%84%e5%8f%98%e5%8c%96%2c%20q%26rsquo%3b%e6%98%afq%e7%9a%84%e5%a2%9e%e9%87%8f%e7%89%88%e6%9c%ac%e3%80%82%20%e4%ba%a7%e7%94%9fappend-only%e7%9a%84%e8%a1%a8%ef%bc%8c%e5%8f%af%e4%bb%a5%e4%bb%8e%e8%be%93%e5%85%a5%e8%a1%a8%e7%9a%84%e5%b0%be%e7%ab%af%e7%9b%b4%e6%8e%a5%e8%ae%a1%e7%ae%97%e5%87%ba%e6%96%b0%e6%95%b0%e6%8d%ae%e3%80%82%e6%9f%a5%e8%af%a2%e5%8f%af%e4%bb%a5%e8%a1%a8%e7%a4%ba%e4%b8%ba%20Q%28t%2b1%29%20%3d%20q%27%27%28c%28T%2c%20t-x%2c%20t%2b1%29%29%20%e2%88%aa%20Q%28t%29%ef%bc%8cq%27%26lsquo%3b%e6%98%af%e4%b8%8d%e9%9c%80%e8%a6%81%e6%97%b6%e9%97%b4t%e6%97%b6q%e7%9a%84%e7%bb%93%e6%9e%9c%e5%a2%9e%e9%87%8f%e7%89%88%e6%9c%acquery%20q%e3%80%82c%28T%2c%20t-x%2c%20t%2b1%29%e6%98%af%e8%a1%a8T%e5%b0%be%e9%83%a8%e7%9a%84x%2b1%e4%b8%aa%e6%95%b0%e6%8d%ae%ef%bc%8cx%e5%8f%96%e5%86%b3%e4%ba%8e%e8%af%ad%e4%b9%89%e3%80%82%e4%be%8b%e5%a6%82%e6%9c%80%e5%90%8e%e4%b8%80%e5%b0%8f%e6%97%b6%e7%9a%84window%20aggregation%e8%87%b3%e5%b0%91%e9%9c%80%e8%a6%81%e6%9c%80%e5%90%8e%e4%b8%80%e5%b0%8f%e6%97%b6%e7%9a%84%e6%95%b0%e6%8d%ae%e4%bd%9c%e4%b8%ba%e7%8a%b6%e6%80%81%e3%80%82%e5%85%b6%e4%bb%96%e8%83%bd%e6%94%af%e6%8c%81%e7%9a%84%e6%9f%a5%e8%af%a2%e7%b1%bb%e5%9e%8b%e8%bf%98%e6%9c%89%ef%bc%9a%e5%8d%95%e7%8b%ac%e5%9c%a8%e6%af%8f%e4%b8%80%e8%a1%8c%e4%b8%8a%e6%93%8d%e4%bd%9c%e7%9a%84SELECT%20WHERE%ef%bc%9browtime%e4%b8%8a%e7%9a%84GROUP%20BY%e5%ad%90%e5%8f%a5%ef%bc%88%e6%af%94%e5%a6%82%e5%9f%ba%e4%ba%8e%e6%97%b6%e9%97%b4%e7%9a%84window%20aggregate%ef%bc%89%ef%bc%9bORDER%20BY%20rowtime%e7%9a%84OVER%20windows%28row-windows%29%ef%bc%9bORDER%20BY%20rowtime%e3%80%82%203." aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fmtunique.com%2fposts%2fflink_sql_outlook%2f&t=Flink%20Table%2fSQL%20API%20%e8%a7%84%e5%88%92%20%e2%80%94%e2%80%94%20Dynamic%20Table" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick="return $('#nav-footer').toggle(),!1" aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick="return $('#toc-footer').toggle(),!1" aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick="return $('#share-footer').toggle(),!1" aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2021 mtunique</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script></html>